"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.load = exports.definitions = void 0;
var _utils = require("@graphql-tools/utils");
var _FunctionsRouter = require("../../Routers/FunctionsRouter");
function ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }
function _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(t) { var i = _toPrimitive(t, "string"); return "symbol" == typeof i ? i : String(i); }
function _toPrimitive(t, r) { if ("object" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || "default"); if ("object" != typeof i) return i; throw new TypeError("@@toPrimitive must return a primitive value."); } return ("string" === r ? String : Number)(t); }
const definitions = exports.definitions = `
  directive @resolve(to: String) on FIELD_DEFINITION
  directive @mock(with: Any!) on FIELD_DEFINITION
`;
const load = parseGraphQLSchema => {
  parseGraphQLSchema.graphQLSchemaDirectivesDefinitions = definitions;
  const resolveDirective = schema => (0, _utils.mapSchema)(schema, {
    [_utils.MapperKind.OBJECT_FIELD]: fieldConfig => {
      var _getDirective;
      const directive = (_getDirective = (0, _utils.getDirective)(schema, fieldConfig, 'resolve')) === null || _getDirective === void 0 ? void 0 : _getDirective[0];
      if (directive) {
        const {
          to: targetCloudFunction
        } = directive;
        fieldConfig.resolve = async (_source, args, context, gqlInfo) => {
          try {
            const {
              config,
              auth,
              info
            } = context;
            const functionName = targetCloudFunction || gqlInfo.fieldName;
            return (await _FunctionsRouter.FunctionsRouter.handleCloudFunction({
              params: {
                functionName
              },
              config,
              auth,
              info,
              body: args,
              parent: _objectSpread({
                className: String(gqlInfo.parentType)
              }, _source)
            })).response.result;
          } catch (e) {
            parseGraphQLSchema.handleError(e);
          }
        };
      }
      return fieldConfig;
    }
  });
  const mockDirective = schema => (0, _utils.mapSchema)(schema, {
    [_utils.MapperKind.OBJECT_FIELD]: fieldConfig => {
      var _getDirective2;
      const directive = (_getDirective2 = (0, _utils.getDirective)(schema, fieldConfig, 'mock')) === null || _getDirective2 === void 0 ? void 0 : _getDirective2[0];
      if (directive) {
        const {
          with: mockValue
        } = directive;
        fieldConfig.resolve = async () => mockValue;
      }
      return fieldConfig;
    }
  });
  parseGraphQLSchema.graphQLSchemaDirectives = schema => mockDirective(resolveDirective(schema));
};
exports.load = load;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdXRpbHMiLCJyZXF1aXJlIiwiX0Z1bmN0aW9uc1JvdXRlciIsIm93bktleXMiLCJlIiwiciIsInQiLCJPYmplY3QiLCJrZXlzIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwibyIsImZpbHRlciIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImVudW1lcmFibGUiLCJwdXNoIiwiYXBwbHkiLCJfb2JqZWN0U3ByZWFkIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiZm9yRWFjaCIsIl9kZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvcnMiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiZGVmaW5lUHJvcGVydHkiLCJvYmoiLCJrZXkiLCJ2YWx1ZSIsIl90b1Byb3BlcnR5S2V5IiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJpIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiU3ltYm9sIiwidG9QcmltaXRpdmUiLCJjYWxsIiwiVHlwZUVycm9yIiwiTnVtYmVyIiwiZGVmaW5pdGlvbnMiLCJleHBvcnRzIiwibG9hZCIsInBhcnNlR3JhcGhRTFNjaGVtYSIsImdyYXBoUUxTY2hlbWFEaXJlY3RpdmVzRGVmaW5pdGlvbnMiLCJyZXNvbHZlRGlyZWN0aXZlIiwic2NoZW1hIiwibWFwU2NoZW1hIiwiTWFwcGVyS2luZCIsIk9CSkVDVF9GSUVMRCIsImZpZWxkQ29uZmlnIiwiX2dldERpcmVjdGl2ZSIsImRpcmVjdGl2ZSIsImdldERpcmVjdGl2ZSIsInRvIiwidGFyZ2V0Q2xvdWRGdW5jdGlvbiIsInJlc29sdmUiLCJfc291cmNlIiwiYXJncyIsImNvbnRleHQiLCJncWxJbmZvIiwiY29uZmlnIiwiYXV0aCIsImluZm8iLCJmdW5jdGlvbk5hbWUiLCJmaWVsZE5hbWUiLCJGdW5jdGlvbnNSb3V0ZXIiLCJoYW5kbGVDbG91ZEZ1bmN0aW9uIiwicGFyYW1zIiwiYm9keSIsInBhcmVudCIsImNsYXNzTmFtZSIsInBhcmVudFR5cGUiLCJyZXNwb25zZSIsInJlc3VsdCIsImhhbmRsZUVycm9yIiwibW9ja0RpcmVjdGl2ZSIsIl9nZXREaXJlY3RpdmUyIiwid2l0aCIsIm1vY2tWYWx1ZSIsImdyYXBoUUxTY2hlbWFEaXJlY3RpdmVzIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL0dyYXBoUUwvbG9hZGVycy9zY2hlbWFEaXJlY3RpdmVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1hcFNjaGVtYSwgZ2V0RGlyZWN0aXZlLCBNYXBwZXJLaW5kIH0gZnJvbSAnQGdyYXBocWwtdG9vbHMvdXRpbHMnO1xuaW1wb3J0IHsgRnVuY3Rpb25zUm91dGVyIH0gZnJvbSAnLi4vLi4vUm91dGVycy9GdW5jdGlvbnNSb3V0ZXInO1xuXG5leHBvcnQgY29uc3QgZGVmaW5pdGlvbnMgPSBgXG4gIGRpcmVjdGl2ZSBAcmVzb2x2ZSh0bzogU3RyaW5nKSBvbiBGSUVMRF9ERUZJTklUSU9OXG4gIGRpcmVjdGl2ZSBAbW9jayh3aXRoOiBBbnkhKSBvbiBGSUVMRF9ERUZJTklUSU9OXG5gO1xuXG5jb25zdCBsb2FkID0gcGFyc2VHcmFwaFFMU2NoZW1hID0+IHtcbiAgcGFyc2VHcmFwaFFMU2NoZW1hLmdyYXBoUUxTY2hlbWFEaXJlY3RpdmVzRGVmaW5pdGlvbnMgPSBkZWZpbml0aW9ucztcblxuICBjb25zdCByZXNvbHZlRGlyZWN0aXZlID0gc2NoZW1hID0+XG4gICAgbWFwU2NoZW1hKHNjaGVtYSwge1xuICAgICAgW01hcHBlcktpbmQuT0JKRUNUX0ZJRUxEXTogZmllbGRDb25maWcgPT4ge1xuICAgICAgICBjb25zdCBkaXJlY3RpdmUgPSBnZXREaXJlY3RpdmUoc2NoZW1hLCBmaWVsZENvbmZpZywgJ3Jlc29sdmUnKT8uWzBdO1xuICAgICAgICBpZiAoZGlyZWN0aXZlKSB7XG4gICAgICAgICAgY29uc3QgeyB0bzogdGFyZ2V0Q2xvdWRGdW5jdGlvbiB9ID0gZGlyZWN0aXZlO1xuICAgICAgICAgIGZpZWxkQ29uZmlnLnJlc29sdmUgPSBhc3luYyAoX3NvdXJjZSwgYXJncywgY29udGV4dCwgZ3FsSW5mbykgPT4ge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgeyBjb25maWcsIGF1dGgsIGluZm8gfSA9IGNvbnRleHQ7XG4gICAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTmFtZSA9IHRhcmdldENsb3VkRnVuY3Rpb24gfHwgZ3FsSW5mby5maWVsZE5hbWU7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgYXdhaXQgRnVuY3Rpb25zUm91dGVyLmhhbmRsZUNsb3VkRnVuY3Rpb24oe1xuICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgICAgICAgICBhdXRoLFxuICAgICAgICAgICAgICAgICAgaW5mbyxcbiAgICAgICAgICAgICAgICAgIGJvZHk6IGFyZ3MsXG4gICAgICAgICAgICAgICAgICBwYXJlbnQ6IHtcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiBTdHJpbmcoZ3FsSW5mby5wYXJlbnRUeXBlKSxcbiAgICAgICAgICAgICAgICAgICAgLi4uX3NvdXJjZSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgKS5yZXNwb25zZS5yZXN1bHQ7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIHBhcnNlR3JhcGhRTFNjaGVtYS5oYW5kbGVFcnJvcihlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmaWVsZENvbmZpZztcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgY29uc3QgbW9ja0RpcmVjdGl2ZSA9IHNjaGVtYSA9PlxuICAgIG1hcFNjaGVtYShzY2hlbWEsIHtcbiAgICAgIFtNYXBwZXJLaW5kLk9CSkVDVF9GSUVMRF06IGZpZWxkQ29uZmlnID0+IHtcbiAgICAgICAgY29uc3QgZGlyZWN0aXZlID0gZ2V0RGlyZWN0aXZlKHNjaGVtYSwgZmllbGRDb25maWcsICdtb2NrJyk/LlswXTtcbiAgICAgICAgaWYgKGRpcmVjdGl2ZSkge1xuICAgICAgICAgIGNvbnN0IHsgd2l0aDogbW9ja1ZhbHVlIH0gPSBkaXJlY3RpdmU7XG4gICAgICAgICAgZmllbGRDb25maWcucmVzb2x2ZSA9IGFzeW5jICgpID0+IG1vY2tWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmllbGRDb25maWc7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gIHBhcnNlR3JhcGhRTFNjaGVtYS5ncmFwaFFMU2NoZW1hRGlyZWN0aXZlcyA9IHNjaGVtYSA9PiBtb2NrRGlyZWN0aXZlKHJlc29sdmVEaXJlY3RpdmUoc2NoZW1hKSk7XG59O1xuZXhwb3J0IHsgbG9hZCB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxNQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxnQkFBQSxHQUFBRCxPQUFBO0FBQWdFLFNBQUFFLFFBQUFDLENBQUEsRUFBQUMsQ0FBQSxRQUFBQyxDQUFBLEdBQUFDLE1BQUEsQ0FBQUMsSUFBQSxDQUFBSixDQUFBLE9BQUFHLE1BQUEsQ0FBQUUscUJBQUEsUUFBQUMsQ0FBQSxHQUFBSCxNQUFBLENBQUFFLHFCQUFBLENBQUFMLENBQUEsR0FBQUMsQ0FBQSxLQUFBSyxDQUFBLEdBQUFBLENBQUEsQ0FBQUMsTUFBQSxXQUFBTixDQUFBLFdBQUFFLE1BQUEsQ0FBQUssd0JBQUEsQ0FBQVIsQ0FBQSxFQUFBQyxDQUFBLEVBQUFRLFVBQUEsT0FBQVAsQ0FBQSxDQUFBUSxJQUFBLENBQUFDLEtBQUEsQ0FBQVQsQ0FBQSxFQUFBSSxDQUFBLFlBQUFKLENBQUE7QUFBQSxTQUFBVSxjQUFBWixDQUFBLGFBQUFDLENBQUEsTUFBQUEsQ0FBQSxHQUFBWSxTQUFBLENBQUFDLE1BQUEsRUFB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